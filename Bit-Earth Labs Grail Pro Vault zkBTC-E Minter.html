<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bit-Earth Labs: PoE zkBTC-E Minting Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto Mono', monospace;
        }

        body {
            background: linear-gradient(135deg, #0a0f2c 0%, #1a1f3c 100%);
            color: #e0e0ff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 2px solid #00C2FF;
            margin-bottom: 40px;
            background: rgba(10, 15, 44, 0.8);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 194, 255, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .logo-icon {
            font-size: 2.5rem;
            color: #00E676;
            animation: pulse 2s infinite;
        }

        h1 {
            font-size: 2.8rem;
            background: linear-gradient(90deg, #00C2FF, #00E676);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
        }

        .tagline {
            font-size: 1.2rem;
            color: #88aaff;
            font-weight: 300;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 900px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: rgba(20, 25, 60, 0.7);
            border: 1px solid rgba(0, 194, 255, 0.3);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 194, 255, 0.15);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 194, 255, 0.2);
        }

        .card-icon {
            font-size: 1.5rem;
            color: #F7931A;
        }

        h2 {
            color: #00C2FF;
            font-size: 1.5rem;
        }

        .upload-area {
            border: 2px dashed rgba(0, 194, 255, 0.5);
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            background: rgba(0, 194, 255, 0.05);
            border-color: #00E676;
        }

        .upload-icon {
            font-size: 3rem;
            color: #00E676;
            margin-bottom: 15px;
        }

        .btn {
            background: linear-gradient(90deg, #F7931A, #00E676);
            color: #0a0f2c;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(247, 147, 26, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: linear-gradient(90deg, #00C2FF, #0099CC);
        }

        .btn-burn {
            background: linear-gradient(90deg, #FF6B6B, #FF8E53);
            margin-top: 15px;
        }

        .process-flow {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 30px;
        }

        .flow-step {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border-left: 4px solid #F7931A;
        }

        .step-active {
            border-left-color: #00E676;
            background: rgba(0, 230, 118, 0.1);
        }

        .step-number {
            width: 30px;
            height: 30px;
            background: #F7931A;
            color: #0a0f2c;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .step-active .step-number {
            background: #00E676;
        }

        .wallet-input {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(0, 194, 255, 0.5);
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            margin-bottom: 20px;
            transition: border-color 0.3s;
        }

        .wallet-input:focus {
            outline: none;
            border-color: #00E676;
        }

        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .metric-card {
            background: rgba(0, 194, 255, 0.1);
            border: 1px solid rgba(0, 194, 255, 0.3);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #00E676;
            margin: 10px 0;
        }

        .metric-label {
            color: #88aaff;
            font-size: 0.9rem;
        }

        .zk-proof {
            background: rgba(0, 230, 118, 0.1);
            border: 1px solid #00E676;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            word-break: break-all;
            font-family: 'Roboto Mono', monospace;
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .chain-agnostic-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 194, 255, 0.2);
            padding: 5px 15px;
            border-radius: 20px;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .chain-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .bitcoin { background: #F7931A; }
        .cardano { background: #0033AD; }
        .monero { background: #FF6600; }
        .dogecoin { background: #C2A633; }
        .zcash { background: #F4B728; }
        .sovryn-dollar { background: #F5A623; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes minting {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .minting-animation {
            animation: minting 0.5s ease-out;
        }

        .transaction-link {
            color: #00C2FF;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-top: 10px;
        }

        .transaction-link:hover {
            text-decoration: underline;
        }

        /* BitcoinOS Explorer Modal Styles - ADDED */
        .explorer-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            animation: fadeIn 0.3s ease;
        }

        .explorer-content {
            background: linear-gradient(135deg, #0a0f2c 0%, #1a1f3c 100%);
            margin: 5% auto;
            padding: 0;
            width: 90%;
            max-width: 800px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 194, 255, 0.3);
            border: 2px solid #00C2FF;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        .explorer-header {
            padding: 20px;
            border-bottom: 1px solid rgba(0, 194, 255, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .explorer-header h3 {
            color: #00C2FF;
            font-size: 1.5rem;
            margin: 0;
        }

        .close-explorer {
            color: #88aaff;
            font-size: 28px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-explorer:hover {
            background: rgba(0, 194, 255, 0.1);
        }

        .explorer-body {
            padding: 20px;
            overflow-y: auto;
            flex-grow: 1;
        }

        .wallet-info {
            background: rgba(0, 194, 255, 0.08);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .wallet-info p {
            margin: 5px 0;
            color: #e0e0ff;
        }

        .tx-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tx-filter {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            background: rgba(0, 194, 255, 0.1);
            border: 1px solid rgba(0, 194, 255, 0.3);
            border-radius: 20px;
            color: #88aaff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: #00C2FF;
            color: #0a0f2c;
        }

        .refresh-btn {
            padding: 8px 16px;
            background: rgba(247, 147, 26, 0.1);
            border: 1px solid rgba(247, 147, 26, 0.3);
            border-radius: 8px;
            color: #F7931A;
            cursor: pointer;
        }

        .tx-history h4 {
            color: #00C2FF;
            margin-bottom: 15px;
        }

        .tx-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-height: 200px;
        }

        .tx-placeholder {
            text-align: center;
            padding: 40px 20px;
            color: #88aaff;
        }

        .tx-item {
            background: rgba(20, 25, 60, 0.7);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-left: 4px solid;
        }

        .tx-item.mint {
            border-left-color: #00E676;
        }

        .tx-item.bridge {
            border-left-color: #F7931A;
        }

        .tx-item.burn {
            border-left-color: #FF6B6B;
        }

        .tx-icon {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tx-details {
            flex-grow: 1;
        }

        .tx-type {
            font-weight: bold;
            color: #fff;
        }

        .tx-amount {
            color: #00E676;
            font-weight: bold;
        }

        .tx-time {
            font-size: 0.85rem;
            color: #88aaff;
        }

        .tx-status {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .tx-status.confirmed {
            background: rgba(0, 230, 118, 0.2);
            color: #00E676;
        }

        .explorer-footer {
            padding: 20px;
            border-top: 1px solid rgba(0, 194, 255, 0.3);
            text-align: center;
        }

        .explorer-link {
            background: linear-gradient(90deg, #00C2FF, #00E676);
            color: #0a0f2c;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
        }

        /* Burn Mechanism Styles - ADDED */
        .burn-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 107, 107, 0.3);
        }

        .burn-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: #FF6B6B;
        }

        .asset-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .asset-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            min-height: 120px;
        }

        .asset-option:hover {
            background: rgba(255, 107, 107, 0.2);
            transform: translateY(-2px);
        }

        .asset-option.selected {
            background: rgba(255, 107, 107, 0.3);
            border-color: #FF6B6B;
        }

        .asset-icon {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .conversion-rate {
            background: rgba(0, 194, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .burn-address {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            font-family: 'Roboto Mono', monospace;
            font-size: 0.9rem;
            word-break: break-all;
            margin: 15px 0;
            border: 1px solid rgba(255, 107, 107, 0.5);
        }

        .liquidity-pool {
            background: rgba(0, 230, 118, 0.1);
            border: 1px solid #00E676;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">‚ö°</div>
                <h1>Bit-Earth Labs</h1>
            </div>
            <p class="tagline">Proof-of-Energy zkBTC-E Minting Simulator | Bitcoin-Powered DePIN</p>
        </header>

        <div class="main-grid">
            <!-- Left Column: Data Upload & Processing -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üìä</div>
                    <h2>Step 1: Upload Energy Generation Data</h2>
                </div>
                
                <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <p>Drag & drop your <strong>datalog.txt</strong> file here</p>
                    <p style="color: #88aaff; margin-top: 10px; font-size: 0.9rem;">
                        Expected format: timestamp(ms),voltage_change(V)<br>
                        Example: 1640995200000,-0.5
                    </p>
                </div>

                <input type="file" id="fileInput" accept=".txt" style="display: none;" onchange="handleFileUpload(event)">
                
                <div class="process-flow">
                    <div class="flow-step" id="step1">
                        <div class="step-number">1</div>
                        <div>
                            <strong>Data Upload & Validation</strong>
                            <p style="color: #88aaff; font-size: 0.9rem;">Upload your sensor data for processing</p>
                        </div>
                    </div>
                    
                    <div class="flow-step" id="step2">
                        <div class="step-number">2</div>
                        <div>
                            <strong>Oracle Verification</strong>
                            <p style="color: #88aaff; font-size: 0.9rem;">BOS Oracle Network validates the data</p>
                        </div>
                    </div>
                    
                    <div class="flow-step" id="step3">
                        <div class="step-number">3</div>
                        <div>
                            <strong>Grail Pro Vault Minting</strong>
                            <p style="color: #88aaff; font-size: 0.9rem;">Smart contract executes minting logic</p>
                        </div>
                    </div>
                    
                    <div class="flow-step" id="step4">
                        <div class="step-number">4</div>
                        <div>
                            <strong>Distribution & Settlement</strong>
                            <p style="color: #88aaff; font-size: 0.9rem;">Tokens distributed to beneficiaries</p>
                        </div>
                    </div>
                </div>

                <button class="btn" id="processBtn" onclick="processEnergyData()" disabled>
                    <i class="fas fa-bolt"></i> Process & Mint zkBTC-E
                </button>
            </div>

            <!-- Right Column: Results & Wallet -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üëõ</div>
                    <h2>Step 2: Receive Chain-Agnostic Tokens</h2>
                </div>

                <p style="margin-bottom: 15px; color: #88aaff;">
                    Enter your Cardano wallet address to receive zkBTC-E tokens. These are chain-agnostic and can be bridged to any supported network.
                </p>

                <input type="text" 
                       class="wallet-input" 
                       id="walletAddress" 
                       placeholder="addr1q9... (Cardano wallet address)"
                       pattern="^addr1[a-z0-9]+$"
                       title="Enter a valid Cardano wallet address">
                
                <div class="chain-agnostic-badge">
                    <span>Chain Agnostic Tokens:</span>
                    <div class="chain-icon bitcoin">‚Çø</div>
                    <div class="chain-icon cardano">A</div>
                    <div class="chain-icon monero">M</div>
                </div>

                <div id="resultsSection" style="display: none;">
                    <div class="results">
                        <div class="metric-card">
                            <div class="metric-label">Energy Generated</div>
                            <div class="metric-value" id="energyGenerated">0 kWh</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-label">zkBTC-E Minted</div>
                            <div class="metric-value" id="zkBTCMinted">0</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-label">To Prosumer</div>
                            <div class="metric-value" id="toProsumer">0</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-label">To Treasury</div>
                            <div class="metric-value" id="toTreasury">0</div>
                        </div>
                    </div>

                    <div class="zk-proof" id="zkProof">
                        <strong>Zero-Knowledge Proof Generated:</strong><br>
                        <span id="proofContent">Waiting for data...</span>
                    </div>

                    <div style="margin-top: 20px;">
                        <a href="#" class="transaction-link" id="txLink" onclick="openBitcoinOSExplorer(); return false;">
                            <i class="fas fa-external-link-alt"></i> View BitcoinOS Explorer
                        </a>
                    </div>

                    <button class="btn btn-secondary" style="margin-top: 20px;" onclick="simulateCrossChainBridge()">
                        <i class="fas fa-bridge"></i> Bridge to Cardano Testnet
                    </button>

                    <!-- Burn Mechanism Section - ADDED -->
                    <div class="burn-section">
                        <div class="burn-header">
                            <i class="fas fa-fire"></i>
                            <h3>Burn zkBTC-E for Backing Assets</h3>
                        </div>
                        
                        <div class="liquidity-pool">
                            <strong>Grail Pro Vault Liquidity Pool:</strong>
                            <p style="margin: 10px 0; color: #88aaff;">
                                Each zkBTC-E is backed by $70 in digital assets
                            </p>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                                <div class="chain-icon bitcoin">‚Çø</div>
                                <div class="chain-icon cardano">A</div>
                                <div class="chain-icon monero">M</div>
                                <div class="chain-icon dogecoin">√ê</div>
                                <div class="chain-icon zcash">‚ì©</div>
                                <div class="chain-icon sovryn-dollar">$</div>
                            </div>
                        </div>

                        <div class="conversion-rate">
                            <strong>Conversion Rate: 1 zkBTC-E = $70</strong><br>
                            <small style="color: #88aaff;">Based on global average MWh price</small>
                        </div>

                        <div class="asset-selector" id="assetSelector">
                            <!-- Options will be added dynamically -->
                        </div>

                        <div id="burnControls" style="display: none;">
                            <p style="margin: 15px 0; color: #88aaff;">
                                Available to burn: <strong id="availableToBurn">0</strong> zkBTC-E
                            </p>
                            
                            <input type="text" 
                                   class="wallet-input" 
                                   id="assetWalletAddress" 
                                   placeholder="Enter compatible wallet address for selected asset"
                                   style="margin-bottom: 10px;">
                            
                            <div class="burn-address">
                                <strong>Burn Address:</strong><br>
                                <span id="burnAddressDisplay">bc1qgrailproburnvaultxyz1234567890abcdef</span>
                            </div>

                            <button class="btn btn-burn" onclick="burnForAssets()">
                                <i class="fas fa-fire"></i> Burn & Receive Assets
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tokenomics Visualization -->
        <div class="card" style="margin-top: 30px;">
            <div class="card-header">
                <div class="card-icon">üìà</div>
                <h2>Token Distribution & Economics</h2>
            </div>
            
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">
                <div>
                    <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Prosumer (Energy Generator)</span>
                            <span style="color: #00E676;">85%</span>
                        </div>
                        <div style="height: 20px; background: rgba(0,0,0,0.5); border-radius: 10px; overflow: hidden;">
                            <div id="prosumerBar" style="height: 100%; width: 85%; background: linear-gradient(90deg, #00E676, #00C2FF); transition: width 1s;"></div>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; margin: 20px 0 10px 0;">
                            <span>Network & Development</span>
                            <span style="color: #F7931A;">15%</span>
                        </div>
                        <div style="height: 20px; background: rgba(0,0,0,0.5); border-radius: 10px; overflow: hidden;">
                            <div id="treasuryBar" style="height: 100%; width: 15%; background: linear-gradient(90deg, #F7931A, #FF6B6B); transition: width 1s;"></div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h3 style="color: #00C2FF; margin-bottom: 15px;">Live Minting Formula</h3>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; font-family: 'Roboto Mono', monospace;">
                            <div id="formulaDisplay">zkBTC-E = Œ£(ŒîV √ó 10) √ó 1.0</div>
                            <div style="color: #88aaff; font-size: 0.9rem; margin-top: 10px;">
                                Where: ŒîV = Voltage change, 10 = conversion factor, 1.0 = energy efficiency coefficient
                            </div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 style="color: #00C2FF; margin-bottom: 15px;">Protocol Benefits</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 10px 0; border-bottom: 1px solid rgba(0,194,255,0.2);">
                            <i class="fas fa-shield-alt" style="color: #00E676; margin-right: 10px;"></i>
                            Bitcoin-Secured
                        </li>
                        <li style="padding: 10px 0; border-bottom: 1px solid rgba(0,194,255,0.2);">
                            <i class="fas fa-user-secret" style="color: #00E676; margin-right: 10px;"></i>
                            Zero-Knowledge Privacy
                        </li>
                        <li style="padding: 10px 0; border-bottom: 1px solid rgba(0,194,255,0.2);">
                            <i class="fas fa-sync-alt" style="color: #00E676; margin-right: 10px;"></i>
                            Chain Agnostic
                        </li>
                        <li style="padding: 10px 0; border-bottom: 1px solid rgba(0,194,255,0.2);">
                            <i class="fas fa-coins" style="color: #00E676; margin-right: 10px;"></i>
                            Asset-Backed ($70/zkBTC-E)
                        </li>
                        <li style="padding: 10px 0;">
                            <i class="fas fa-leaf" style="color: #00E676; margin-right: 10px;"></i>
                            Green Economy
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- BitcoinOS Explorer Modal - ADDED -->
    <div id="explorerModal" class="explorer-modal">
        <div class="explorer-content">
            <div class="explorer-header">
                <h3><i class="fas fa-search"></i> BitcoinOS Explorer</h3>
                <span class="close-explorer" onclick="closeExplorer()">&times;</span>
            </div>
            <div class="explorer-body">
                <div class="wallet-info">
                    <p><strong>Wallet Address:</strong> <span id="explorerWalletAddress">Not connected</span></p>
                    <p><strong>Total zkBTC-E:</strong> <span id="explorerBalance">0</span></p>
                    <p><strong>Network:</strong> <span style="color: #00E676;">BitcoinOS Testnet</span></p>
                </div>
                
                <div class="tx-controls">
                    <div class="tx-filter">
                        <button class="filter-btn active" onclick="filterTransactions('all')">All</button>
                        <button class="filter-btn" onclick="filterTransactions('mint')">Mints</button>
                        <button class="filter-btn" onclick="filterTransactions('bridge')">Bridges</button>
                        <button class="filter-btn" onclick="filterTransactions('burn')">Burns</button>
                    </div>
                    <button class="refresh-btn" onclick="refreshTransactions()">
                        <i class="fas fa-redo"></i> Refresh
                    </button>
                </div>
                
                <div class="tx-history">
                    <h4>Transaction History</h4>
                    <div class="tx-list" id="txList">
                        <div class="tx-placeholder">
                            <i class="fas fa-history" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>No transactions yet</p>
                            <small>Mint zkBTC-E to see transaction history</small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="explorer-footer">
                <button class="explorer-link" onclick="window.open('https://explorer.bitcoinos.org', '_blank')">
                    <i class="fas fa-external-link-alt"></i> Open Full BitcoinOS Explorer
                </button>
            </div>
        </div>
    </div>

    <script>
        let energyData = [];
        let totalEnergy = 0;
        let mintedTokens = 0;
        let prosumerShare = 0;
        let treasuryShare = 0;
        let transactionHistory = [];
        let selectedAsset = null;
        let assets = [
            { 
                id: 'bitcoin', 
                name: 'Bitcoin', 
                symbol: 'BTC', 
                icon: '‚Çø', 
                color: '#F7931A', 
                regex: /^(bc1|[13])[a-zA-HJ-NP-Z0-9]{25,39}$/ 
            },
            { 
                id: 'cardano', 
                name: 'Cardano', 
                symbol: 'ADA', 
                icon: 'A', 
                color: '#0033AD', 
                regex: /^addr1[a-z0-9]+$/ 
            },
            { 
                id: 'monero', 
                name: 'Monero', 
                symbol: 'XMR', 
                icon: 'M', 
                color: '#FF6600', 
                regex: /^4[0-9AB][1-9A-HJ-NP-Za-km-z]{93}$/ 
            },
            { 
                id: 'dogecoin', 
                name: 'Dogecoin', 
                symbol: 'DOGE', 
                icon: '√ê', 
                color: '#C2A633', 
                regex: /^D{1}[5-9A-HJ-NP-U]{1}[1-9A-HJ-NP-Za-km-z]{32}$/ 
            },
            { 
                id: 'zcash', 
                name: 'ZCash', 
                symbol: 'ZEC', 
                icon: '‚ì©', 
                color: '#F4B728', 
                regex: /^t1[a-zA-Z0-9]{33}$/ 
            },
            { 
                id: 'sovryn-dollar', 
                name: 'Sovryn Dollar', 
                symbol: 'DLLR', 
                icon: '$', 
                color: '#F5A623', 
                regex: /^0x[a-fA-F0-9]{40}$/ 
            }
        ];

        // Initialize asset selector
        function initializeAssetSelector() {
            const selector = document.getElementById('assetSelector');
            selector.innerHTML = '';
            
            assets.forEach(asset => {
                const option = document.createElement('div');
                option.className = 'asset-option';
                option.id = `asset-${asset.id}`;
                option.onclick = () => selectAsset(asset);
                
                option.innerHTML = `
                    <div class="asset-icon" style="color: ${asset.color}">${asset.icon}</div>
                    <div style="font-size: 0.9rem; font-weight: bold; text-align: center;">${asset.name}</div>
                    <div style="font-size: 0.8rem; color: #88aaff; text-align: center;">${asset.symbol}</div>
                `;
                
                selector.appendChild(option);
            });
        }

        function selectAsset(asset) {
            selectedAsset = asset;
            
            // Update UI
            document.querySelectorAll('.asset-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.getElementById(`asset-${asset.id}`).classList.add('selected');
            
            // Show burn controls
            document.getElementById('burnControls').style.display = 'block';
            document.getElementById('assetWalletAddress').placeholder = `Enter ${asset.name} wallet address`;
            
            // Update available amount
            document.getElementById('availableToBurn').textContent = prosumerShare.toFixed(6);
        }

        // ADDED: Burn mechanism function
        function burnForAssets() {
            const walletAddress = document.getElementById('assetWalletAddress').value;
            
            if (!selectedAsset) {
                showNotification('Please select an asset first', 'error');
                return;
            }
            
            if (!walletAddress) {
                showNotification(`Please enter ${selectedAsset.name} wallet address`, 'error');
                return;
            }
            
            // Validate wallet address format
            if (!selectedAsset.regex.test(walletAddress)) {
                showNotification(`Invalid ${selectedAsset.name} wallet address format`, 'error');
                return;
            }
            
            const amountToBurn = prosumerShare;
            const usdValue = amountToBurn * 70;
            
            showNotification(`Burning ${amountToBurn.toFixed(6)} zkBTC-E...`, 'info');
            
            // Simulate blockchain transaction
            setTimeout(() => {
                // Add burn transaction to history
                addTransactionToHistory({
                    type: 'burn',
                    amount: amountToBurn.toFixed(6),
                    token: `zkBTC-E ‚Üí ${selectedAsset.symbol}`,
                    status: 'confirmed',
                    timestamp: Date.now(),
                    details: `Burned for ${selectedAsset.name} ($${usdValue.toFixed(2)})`
                });
                
                // Update prosumer balance
                prosumerShare = 0;
                document.getElementById('toProsumer').textContent = '0';
                document.getElementById('availableToBurn').textContent = '0';
                
                // Show success message
                const burnResult = document.createElement('div');
                burnResult.style.cssText = `
                    background: rgba(255, 107, 107, 0.1);
                    border: 1px solid #FF6B6B;
                    border-radius: 10px;
                    padding: 20px;
                    margin-top: 20px;
                    animation: minting 0.5s ease-out;
                `;
                
                burnResult.innerHTML = `
                    <h3 style="color: #FF6B6B; margin-bottom: 10px;">
                        <i class="fas fa-check-circle"></i> Burn Complete
                    </h3>
                    <p style="color: #88aaff;">
                        Successfully burned <strong>${amountToBurn.toFixed(6)} zkBTC-E</strong>
                    </p>
                    <p style="color: #88aaff; margin-top: 10px;">
                        Value: <strong>$${usdValue.toFixed(2)}</strong> in ${selectedAsset.name}
                    </p>
                    <p style="color: #88aaff; margin-top: 10px;">
                        Sent to: <code>${walletAddress.substring(0, 20)}...</code>
                    </p>
                    <div style="display: flex; align-items: center; gap: 15px; margin-top: 15px;">
                        <div style="font-size: 2rem;">üî•</div>
                        <div style="font-size: 1.5rem;">‚Üí</div>
                        <div class="chain-icon" style="background: ${selectedAsset.color}">${selectedAsset.icon}</div>
                    </div>
                `;
                
                document.getElementById('burnControls').parentNode.insertBefore(burnResult, document.getElementById('burnControls').nextSibling);
                
                showNotification(`$${usdValue.toFixed(2)} ${selectedAsset.name} sent to your wallet!`, 'success');
                
                // Reset selection
                selectedAsset = null;
                document.querySelectorAll('.asset-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                document.getElementById('assetWalletAddress').value = '';
                document.getElementById('burnControls').style.display = 'none';
                
            }, 2000);
        }

        // MODIFIED: Fixed distribution to 85%/15%
        function processEnergyData() {
            if (energyData.length === 0) {
                showNotification('No data to process', 'error');
                return;
            }

            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('step2').classList.add('step-active');
            
            totalEnergy = energyData.reduce((sum, entry) => {
                return sum + (entry.voltageChange * 10);
            }, 0);
            
            mintedTokens = totalEnergy * 0.001;
            
            animateCounter('energyGenerated', 0, totalEnergy, 2, ' kWh');
            setTimeout(() => {
                document.getElementById('step3').classList.add('step-active');
                animateCounter('zkBTCMinted', 0, mintedTokens, 6);
                
                prosumerShare = mintedTokens * 0.85;
                treasuryShare = mintedTokens * 0.15;
                
                setTimeout(() => {
                    document.getElementById('step4').classList.add('step-active');
                    animateCounter('toProsumer', 0, prosumerShare, 6);
                    animateCounter('toTreasury', 0, treasuryShare, 6);
                    
                    document.getElementById('prosumerBar').style.width = '85%';
                    document.getElementById('treasuryBar').style.width = '15%';
                    
                    generateZKProof();
                    
                    // ADDED: Add mint transaction to history
                    addTransactionToHistory({
                        type: 'mint',
                        amount: mintedTokens.toFixed(6),
                        token: 'zkBTC-E',
                        status: 'confirmed',
                        timestamp: Date.now(),
                        details: 'PoE Mint from Energy Generation'
                    });
                    
                    document.querySelector('.btn-secondary').disabled = false;
                    
                    // Initialize burn section
                    document.getElementById('availableToBurn').textContent = prosumerShare.toFixed(6);
                    initializeAssetSelector();
                    
                    showNotification('zkBTC-E Minting Complete!', 'success');
                }, 500);
            }, 500);
        }

        // Rest of the functions remain the same...
        function openBitcoinOSExplorer() {
            const walletAddress = document.getElementById('walletAddress').value || 'addr1q...demo';
            document.getElementById('explorerWalletAddress').textContent = walletAddress.substring(0, 20) + '...';
            document.getElementById('explorerBalance').textContent = mintedTokens.toFixed(6);
            document.getElementById('explorerModal').style.display = 'block';
            renderTransactionHistory();
        }

        function closeExplorer() {
            document.getElementById('explorerModal').style.display = 'none';
        }

        function filterTransactions(type) {
            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Filter and render transactions
            let filtered = transactionHistory;
            if (type !== 'all') {
                filtered = transactionHistory.filter(tx => tx.type === type);
            }
            renderFilteredTransactions(filtered);
        }

        function refreshTransactions() {
            showNotification('Refreshing transaction history...', 'info');
            renderTransactionHistory();
        }

        function renderTransactionHistory() {
            const txList = document.getElementById('txList');
            
            if (transactionHistory.length === 0) {
                txList.innerHTML = `
                    <div class="tx-placeholder">
                        <i class="fas fa-history" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>No transactions yet</p>
                        <small>Mint zkBTC-E to see transaction history</small>
                    </div>
                `;
                return;
            }
            
            let html = '';
            transactionHistory.forEach(tx => {
                const timeAgo = formatTimeAgo(tx.timestamp);
                const icon = tx.type === 'mint' ? 'ü™ô' : tx.type === 'bridge' ? 'üåâ' : 'üî•';
                const statusClass = tx.status === 'confirmed' ? 'confirmed' : 'pending';
                
                html += `
                    <div class="tx-item ${tx.type}">
                        <div class="tx-icon">${icon}</div>
                        <div class="tx-details">
                            <div class="tx-type">${tx.details}</div>
                            <div class="tx-amount">${tx.amount} ${tx.token}</div>
                            <div class="tx-time">${timeAgo}</div>
                        </div>
                        <div class="tx-status ${statusClass}">${tx.status}</div>
                    </div>
                `;
            });
            
            txList.innerHTML = html;
        }

        function renderFilteredTransactions(filtered) {
            const txList = document.getElementById('txList');
            
            if (filtered.length === 0) {
                txList.innerHTML = `
                    <div class="tx-placeholder">
                        <i class="fas fa-filter" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>No ${document.querySelector('.filter-btn.active').textContent.toLowerCase()} transactions</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            filtered.forEach(tx => {
                const timeAgo = formatTimeAgo(tx.timestamp);
                const icon = tx.type === 'mint' ? 'ü™ô' : tx.type === 'bridge' ? 'üåâ' : 'üî•';
                const statusClass = tx.status === 'confirmed' ? 'confirmed' : 'pending';
                
                html += `
                    <div class="tx-item ${tx.type}">
                        <div class="tx-icon">${icon}</div>
                        <div class="tx-details">
                            <div class="tx-type">${tx.details}</div>
                            <div class="tx-amount">${tx.amount} ${tx.token}</div>
                            <div class="tx-time">${timeAgo}</div>
                        </div>
                        <div class="tx-status ${statusClass}">${tx.status}</div>
                    </div>
                `;
            });
            
            txList.innerHTML = html;
        }

        function formatTimeAgo(timestamp) {
            const seconds = Math.floor((Date.now() - timestamp) / 1000);
            if (seconds < 60) return 'Just now';
            if (seconds < 3600) return `${Math.floor(seconds / 60)} minutes ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)} hours ago`;
            return `${Math.floor(seconds / 86400)} days ago`;
        }

        function addTransactionToHistory(tx) {
            transactionHistory.unshift(tx); // Add to beginning
            if (document.getElementById('explorerModal').style.display === 'block') {
                renderTransactionHistory();
            }
        }

        function simulateCrossChainBridge() {
            const walletAddress = document.getElementById('walletAddress').value;
            
            if (!walletAddress || !walletAddress.startsWith('addr1')) {
                showNotification('Please enter a valid Cardano wallet address', 'error');
                return;
            }
            
            showNotification('Bridging zkBTC-E to Cardano...', 'info');
            
            setTimeout(() => {
                // ADDED: Add bridge transaction to history
                addTransactionToHistory({
                    type: 'bridge',
                    amount: mintedTokens.toFixed(6),
                    token: 'zkBTC-E ‚Üí ‚Ç≥',
                    status: 'confirmed',
                    timestamp: Date.now(),
                    details: 'Bridged to Cardano Network'
                });
                
                const bridgeDiv = document.createElement('div');
                bridgeDiv.style.cssText = `
                    background: rgba(0, 194, 255, 0.1);
                    border: 1px solid #00C2FF;
                    border-radius: 10px;
                    padding: 20px;
                    margin-top: 20px;
                    animation: minting 0.5s ease-out;
                `;
                
                bridgeDiv.innerHTML = `
                    <h3 style="color: #00E676; margin-bottom: 10px;">
                        <i class="fas fa-bridge"></i> Cross-Chain Bridge Complete
                    </h3>
                    <p style="color: #88aaff;">
                        ${mintedTokens.toFixed(6)} zkBTC-E bridged to Cardano
                    </p>
                    <p style="color: #88aaff; margin-top: 10px;">
                        Destination: <code>${walletAddress.substring(0, 20)}...</code>
                    </p>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <div class="chain-icon bitcoin">‚Çø</div>
                        <div style="align-self: center;">‚Üí</div>
                        <div class="chain-icon cardano">A</div>
                    </div>
                `;
                
                document.getElementById('resultsSection').appendChild(bridgeDiv);
                showNotification('Tokens successfully bridged to Cardano!', 'success');
            }, 2000);
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                try {
                    energyData = parseDataFile(content);
                    if (energyData.length > 0) {
                        document.getElementById('processBtn').disabled = false;
                        document.getElementById('step1').classList.add('step-active');
                        showNotification('Data loaded successfully!', 'success');
                    }
                } catch (error) {
                    showNotification('Error parsing file. Check format.', 'error');
                }
            };
            reader.readAsText(file);
        }

        function parseDataFile(content) {
            const lines = content.split('\n');
            const data = [];
            
            lines.forEach((line, index) => {
                line = line.trim();
                if (!line) return;
                
                const parts = line.split(',');
                if (parts.length >= 2) {
                    const timestamp = parseInt(parts[0]);
                    const voltageChange = parseFloat(parts[1]);
                    
                    if (!isNaN(timestamp) && !isNaN(voltageChange)) {
                        data.push({
                            timestamp: timestamp,
                            voltageChange: Math.abs(voltageChange),
                            originalChange: voltageChange
                        });
                    }
                }
            });
            
            return data;
        }

        function animateCounter(elementId, start, end, decimals = 2, suffix = '') {
            const element = document.getElementById(elementId);
            const duration = 1500;
            const steps = 60;
            const stepValue = (end - start) / steps;
            let current = start;
            let step = 0;
            
            const timer = setInterval(() => {
                current += stepValue;
                step++;
                
                if (step >= steps) {
                    current = end;
                    clearInterval(timer);
                }
                
                element.textContent = current.toFixed(decimals) + suffix;
                
                element.classList.add('minting-animation');
                setTimeout(() => element.classList.remove('minting-animation'), 300);
            }, duration / steps);
        }

        function generateZKProof() {
            const proofData = {
                protocol: "PoE zkBTC-E",
                version: "1.0",
                timestamp: Date.now(),
                energyHash: sha256(JSON.stringify(energyData)),
                commitment: "0x" + Array(64).fill(0).map(() => 
                    Math.floor(Math.random() * 16).toString(16)).join(''),
                nullifier: "0x" + Array(64).fill(0).map(() => 
                    Math.floor(Math.random() * 16).toString(16)).join(''),
                merkleRoot: "0x" + Array(64).fill(0).map(() => 
                    Math.floor(Math.random() * 16).toString(16)).join('')
            };
            
            document.getElementById('proofContent').textContent = JSON.stringify(proofData, null, 2);
            
            const txHash = "0x" + Array(64).fill(0).map(() => 
                Math.floor(Math.random() * 16).toString(16)).join('');
            document.getElementById('txLink').href = `https://explorer.bitcoinos.org/tx/${txHash}`;
        }

        function sha256(data) {
            return '0x' + Array(64).fill(0).map(() => 
                Math.floor(Math.random() * 16).toString(16)).join('');
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                animation: minting 0.3s ease-out;
                background: ${type === 'success' ? '#00E676' : 
                           type === 'error' ? '#FF6B6B' : '#00C2FF'};
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(20px)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        window.onload = function() {
            const sampleData = [];
            const now = Date.now();
            for (let i = 0; i < 24; i++) {
                sampleData.push(`${now - (i * 3600000)},${-(Math.random() * 0.8 + 0.2).toFixed(2)}`);
            }
            
            document.getElementById('uploadArea').innerHTML += `
                <div style="margin-top: 20px; font-size: 0.8rem; color: #88aaff;">
                    <strong>Sample data line:</strong><br>
                    <code>${sampleData[0]}</code>
                </div>
            `;
            
            const formulas = [
                "zkBTC-E = Œ£(|ŒîV| √ó 10 √ó Œ∑) √ó 1.0",
                "ŒîV = Voltage change per hour",
                "Œ∑ = Device efficiency (0.85-0.95)",
                "1.0 = PoE Protocol Constant",
                "Backing: 1 zkBTC-E = $70 in assets"
            ];
            
            let formulaIndex = 0;
            setInterval(() => {
                document.getElementById('formulaDisplay').textContent = formulas[formulaIndex];
                formulaIndex = (formulaIndex + 1) % formulas.length;
            }, 3000);
        };

        document.getElementById('uploadArea').addEventListener('dragover', (e) => {
            e.preventDefault();
            e.currentTarget.style.background = 'rgba(0, 194, 255, 0.1)';
        });

        document.getElementById('uploadArea').addEventListener('dragleave', (e) => {
            e.preventDefault();
            e.currentTarget.style.background = '';
        });

        document.getElementById('uploadArea').addEventListener('drop', (e) => {
            e.preventDefault();
            e.currentTarget.style.background = '';
            
            const file = e.dataTransfer.files[0];
            if (file && file.name.endsWith('.txt')) {
                const input = document.getElementById('fileInput');
                input.files = e.dataTransfer.files;
                handleFileUpload({target: input});
            }
        });

        // Close explorer when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('explorerModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        };
    </script>
</body>
</html>